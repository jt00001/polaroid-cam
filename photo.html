<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#f0ece2">
    <meta name="apple-mobile-web-app-title" content="Â§çÂè§ÊãçÁ´ãÂæó">
    <link rel="apple-touch-icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 fill=%22%23d4cdb8%22/><circle cx=%2250%22 cy=%2250%22 r=%2230%22 fill=%22%23333%22/><circle cx=%2250%22 cy=%2250%22 r=%2212%22 fill=%22%23111%22/><circle cx=%2260%22 cy=%2240%22 r=%224%22 fill=%22white%22/></svg>">

    <title>Â§çÂè§ÊãçÁ´ãÂæó Pro</title>
    <style>
        /* --- Âü∫Á°ÄÊ†∑Âºè --- */
        body,
        html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #f0ece2;
            background-image: radial-gradient(#e6e1d3 20%, transparent 20%),
                radial-gradient(#e6e1d3 20%, transparent 20%);
            background-size: 60px 60px;
            background-position: 0 0, 30px 30px;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            overscroll-behavior: none;
            -webkit-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
        }

        #photo-wall {
            width: 100%;
            height: 100%;
            position: relative;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
        }

        /* ÂûÉÂúæÊ°∂Âå∫Âüü */
        #trash-zone {
            position: fixed;
            top: -100px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: rgba(255, 0, 0, 0.1);
            border: 2px dashed red;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: top 0.3s;
            z-index: 500;
        }

        #trash-zone.visible {
            top: 20px;
        }

        #trash-zone::after {
            content: 'üóëÔ∏è';
            font-size: 24px;
        }

        /* --- ‰øùÂ≠òÂõæÁâá‰ΩøÁî®ÁöÑÂºπÁ™ó (Â§áÁî®ÊñπÊ°à) --- */
        #save-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 20000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
            opacity: 0;
            transition: opacity 0.3s;
        }

        #save-modal.visible {
            display: flex;
            opacity: 1;
        }

        #save-img-preview {
            max-width: 80%;
            max-height: 65%;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            margin-bottom: 20px;
            border: 4px solid #fff;
            border-radius: 4px;
        }

        .save-tip {
            color: white;
            font-size: 18px;
            margin-bottom: 25px;
            text-align: center;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            font-weight: bold;
            pointer-events: none;
        }

        .close-modal-btn {
            padding: 12px 40px;
            background: white;
            color: #333;
            border-radius: 30px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .close-modal-btn:active {
            transform: scale(0.95);
            background: #eee;
        }

        /* --- Áõ∏Êú∫ÁïåÈù¢ --- */
        .camera-wrapper {
            position: fixed;
            bottom: calc(20px + env(safe-area-inset-bottom));
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            touch-action: none;
            zoom: 0.9;
        }

        .camera-body {
            width: 240px;
            height: 260px;
            background: #d4cdb8;
            border-radius: 24px;
            border: 6px solid #5a5243;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3), inset 2px 2px 5px rgba(255, 255, 255, 0.3);
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 25px;
        }

        .rainbow-stripe {
            position: absolute;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            width: 140px;
            height: 8px;
            background: linear-gradient(to right, #ff4f4f, #ffed4f, #4fff68, #4f8fff);
            border-radius: 4px;
        }

        .viewfinder-frame {
            width: 180px;
            height: 135px;
            background: #1a1a1a;
            border: 4px solid #333;
            border-radius: 6px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 0 15px #000;
        }

        #video-preview {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1);
            transition: filter 0.3s;
        }

        .filter-name {
            position: absolute;
            top: 5px;
            left: 5px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 10px;
            background: rgba(0, 0, 0, 0.5);
            padding: 2px 6px;
            border-radius: 4px;
            pointer-events: none;
        }

        .controls {
            position: absolute;
            bottom: -25px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 10px;
            box-sizing: border-box;
            pointer-events: none;
        }

        .shutter-btn {
            pointer-events: auto;
            width: 70px;
            height: 70px;
            background-color: #ff4f4f;
            border-radius: 50%;
            border: 4px solid #c23838;
            cursor: pointer;
            box-shadow: 2px 4px 10px rgba(0, 0, 0, 0.3);
            transition: transform 0.1s;
            position: absolute;
            right: -15px;
            bottom: 0;
        }

        .shutter-btn:active {
            transform: scale(0.92);
        }

        .switch-cam-btn {
            pointer-events: auto;
            width: 40px;
            height: 40px;
            background: #333;
            border-radius: 50%;
            border: 2px solid #555;
            color: white;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            left: -10px;
            bottom: 15px;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
        }

        .switch-cam-btn:active {
            background: #555;
        }

        /* --- ÁÖßÁâáÊ†∑Âºè --- */
        .slot-container {
            position: absolute;
            top: -18px;
            left: 50%;
            transform: translateX(-50%);
            width: 180px;
            height: 20px;
            z-index: 90;
            pointer-events: none;
        }

        .polaroid-photo {
            width: 160px;
            height: 192px;
            background-color: #fffdf5;
            padding: 12px 12px 45px 12px;
            box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.15);
            box-sizing: border-box;
            position: absolute;
            top: -9999px;
            left: 0;
            transform-origin: center bottom;
            will-change: transform;
            touch-action: none;
        }

        /* ‰∏ãËΩΩÊåâÈíÆÊ†∑Âºè */
        .download-btn {
            position: absolute;
            bottom: 8px;
            right: 8px;
            width: 32px;
            height: 32px;
            background: rgba(0, 0, 0, 0.08);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            color: #666;
            z-index: 20;
            border: 1px solid rgba(0, 0, 0, 0.1);
            /* Â¢ûÂä†ÁÇπÂáªÂå∫Âüü */
            box-shadow: 0 0 0 5px transparent;
        }

        .download-btn:active {
            background: rgba(0, 0, 0, 0.2);
            color: #333;
        }

        .polaroid-photo.in-slot {
            top: 0;
            left: 10px;
            transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .polaroid-photo.dragging {
            box-shadow: 15px 15px 40px rgba(0, 0, 0, 0.3);
            z-index: 9999 !important;
            transform: scale(1.1) !important;
            transition: none;
        }

        .photo-content {
            width: 100%;
            height: 135px;
            background-color: #111;
            overflow: hidden;
            position: relative;
            filter: brightness(0.1) grayscale(1) blur(2px);
            pointer-events: none;
        }

        .photo-content.developed {
            filter: none !important;
        }

        .photo-content img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        @keyframes developPhoto {
            0% {
                filter: brightness(0.1) grayscale(1) blur(5px);
            }

            40% {
                filter: brightness(0.6) grayscale(0.6) sepia(0.4) blur(2px);
            }

            100% {
                filter: brightness(1) grayscale(0) sepia(0) blur(0);
            }
        }

        .developing {
            animation: developPhoto 4s ease-in-out forwards;
        }

        #flash-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            opacity: 0;
            pointer-events: none;
            z-index: 10000;
            transition: opacity 0.05s;
        }

        #canvas-hidden {
            display: none;
        }

        @media (min-width: 768px) {
            .camera-wrapper {
                left: auto;
                right: 60px;
                bottom: 60px;
                transform: none;
                zoom: 1.2;
            }
        }
    </style>
</head>

<body>

    <div id="flash-overlay"></div>
    <div id="trash-zone"></div>

    <!-- ÁÖßÁâá‰øùÂ≠òÂºπÁ™ó (Êñ∞) -->
    <div id="save-modal">
        <div class="save-tip">üëÜ ÈïøÊåâÂõæÁâá -> Â≠òÂÇ®ÂõæÂÉè</div>
        <img id="save-img-preview" src="" alt="Polaroid">
        <div class="close-modal-btn" id="close-save-modal">ÂÖ≥Èó≠</div>
    </div>

    <div id="photo-wall"></div>

    <div class="camera-wrapper">
        <div class="slot-container" id="slot-container"></div>
        <div class="camera-body">
            <div class="viewfinder-frame" id="viewfinder">
                <div class="filter-name" id="filter-name">Normal</div>
                <video id="video-preview" autoplay playsinline muted></video>
            </div>
            <div class="rainbow-stripe"></div>

            <div class="controls">
                <div class="switch-cam-btn" id="switch-cam">‚Üª</div>
                <div class="shutter-btn" id="shutter-btn"></div>
            </div>
        </div>
    </div>

    <canvas id="canvas-hidden"></canvas>

    <script>
        document.addEventListener('touchmove', e => { if (e.scale !== 1) e.preventDefault(); }, { passive: false });

        // Èü≥Êïà
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playShutterSound() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const t = audioCtx.currentTime;
            const bufferSize = audioCtx.sampleRate * 0.1;
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) data[i] = Math.random() * 2 - 1;
            const noise = audioCtx.createBufferSource();
            noise.buffer = buffer;
            const noiseGain = audioCtx.createGain();
            noiseGain.gain.setValueAtTime(0.5, t);
            noiseGain.gain.exponentialRampToValueAtTime(0.01, t + 0.1);
            noise.connect(noiseGain);
            noiseGain.connect(audioCtx.destination);
            noise.start(t);
            const osc = audioCtx.createOscillator();
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(800, t);
            osc.frequency.exponentialRampToValueAtTime(100, t + 0.15);
            const oscGain = audioCtx.createGain();
            oscGain.gain.setValueAtTime(0.3, t);
            oscGain.gain.exponentialRampToValueAtTime(0.01, t + 0.15);
            osc.connect(oscGain);
            oscGain.connect(audioCtx.destination);
            osc.start(t);
            osc.stop(t + 0.2);
        }

        document.addEventListener('DOMContentLoaded', () => {
            const els = {
                video: document.getElementById('video-preview'),
                shutter: document.getElementById('shutter-btn'),
                switchBtn: document.getElementById('switch-cam'),
                canvas: document.getElementById('canvas-hidden'),
                slot: document.getElementById('slot-container'),
                wall: document.getElementById('photo-wall'),
                flash: document.getElementById('flash-overlay'),
                trash: document.getElementById('trash-zone'),
                viewfinder: document.getElementById('viewfinder'),
                filterName: document.getElementById('filter-name'),
                saveModal: document.getElementById('save-modal'),
                saveImgPreview: document.getElementById('save-img-preview'),
                closeModalBtn: document.getElementById('close-save-modal')
            };
            const ctx = els.canvas.getContext('2d');

            let state = {
                facingMode: 'user',
                zIndex: 1000,
                photos: [],
                currentFilterIndex: 0
            };

            const filters = [
                { name: 'Normal', css: 'none' },
                { name: 'Vintage', css: 'sepia(0.4) contrast(1.2) saturate(0.8)' },
                { name: 'B&W', css: 'grayscale(1) contrast(1.1)' },
                { name: 'Cool', css: 'hue-rotate(180deg) sepia(0.2) opacity(0.9)' }
            ];

            loadSavedPhotos();
            initCamera();

            // ÂÖ≥Èó≠ÂºπÁ™óÈÄªËæë
            els.closeModalBtn.addEventListener('click', () => {
                els.saveModal.classList.remove('visible');
            });

            async function initCamera() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({
                        video: {
                            facingMode: state.facingMode,
                            width: { ideal: 1280 },
                            height: { ideal: 1280 }
                        },
                        audio: false
                    });
                    els.video.srcObject = stream;
                    els.video.onloadedmetadata = () => els.video.play();
                    els.video.style.transform = state.facingMode === 'user' ? 'scaleX(-1)' : 'scaleX(1)';
                } catch (err) {
                    console.error(err);
                    alert("Êó†Ê≥ïÂêØÂä®Áõ∏Êú∫ÔºåËØ∑Ê£ÄÊü•ÊùÉÈôê");
                }
            }

            els.switchBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                state.facingMode = state.facingMode === 'user' ? 'environment' : 'user';
                initCamera();
            });

            els.viewfinder.addEventListener('click', () => {
                state.currentFilterIndex = (state.currentFilterIndex + 1) % filters.length;
                applyFilter();
            });

            function applyFilter() {
                const filter = filters[state.currentFilterIndex];
                els.video.style.filter = filter.css;
                els.filterName.textContent = filter.name;
                els.filterName.style.opacity = 1;
                clearTimeout(window.filterTimer);
                window.filterTimer = setTimeout(() => els.filterName.style.opacity = 0, 2000);
            }

            const triggerPhoto = (e) => {
                e.preventDefault();
                els.flash.style.opacity = 0.8;
                setTimeout(() => els.flash.style.opacity = 0, 100);
                playShutterSound();
                capture();
            };
            els.shutter.addEventListener('touchstart', triggerPhoto, { passive: false });
            els.shutter.addEventListener('mousedown', triggerPhoto);

            function capture() {
                const w = els.video.videoWidth;
                const h = els.video.videoHeight;
                els.canvas.width = w;
                els.canvas.height = h;

                if (state.facingMode === 'user') {
                    ctx.translate(w, 0);
                    ctx.scale(-1, 1);
                }

                ctx.filter = getComputedStyle(els.video).filter;
                ctx.drawImage(els.video, 0, 0, w, h);

                ctx.filter = 'none';
                ctx.setTransform(1, 0, 0, 1, 0, 0);

                const date = new Date();
                const yy = date.getFullYear().toString().substr(2);
                const mm = (date.getMonth() + 1).toString().padStart(2, '0');
                const dd = date.getDate().toString().padStart(2, '0');
                const dateStr = `'${yy} ${mm} ${dd}`;

                const fontSize = h / 20;
                ctx.font = `bold ${fontSize}px "Courier New", monospace`;
                ctx.fillStyle = '#ffaa00';
                ctx.shadowColor = 'rgba(0,0,0,0.5)';
                ctx.shadowBlur = 2;
                ctx.textAlign = 'right';
                ctx.fillText(dateStr, w - (w * 0.05), h - (h * 0.05));

                const imgData = els.canvas.toDataURL('image/jpeg', 0.85);
                createPhotoElement(imgData, true);
            }

            // --- Ê†∏ÂøÉÈÄªËæëÔºö‰∏ãËΩΩ‰∏éÂàÜ‰∫´ ---
            function downloadPolaroid(imgData) {
                const tempCanvas = document.createElement('canvas');
                const tCtx = tempCanvas.getContext('2d');
                const img = new Image();

                img.onload = () => {
                    const photoW = img.width;
                    const photoH = img.height;
                    const margin = photoW * 0.088;
                    const bottomMargin = photoW * 0.33;

                    const finalW = photoW + (margin * 2);
                    const finalH = photoH + margin + bottomMargin;

                    tempCanvas.width = finalW;
                    tempCanvas.height = finalH;

                    tCtx.fillStyle = '#fffdf5';
                    tCtx.fillRect(0, 0, finalW, finalH);

                    tCtx.drawImage(img, margin, margin, photoW, photoH);

                    // 1. Â∞ùËØïÂéüÁîüÂàÜ‰∫´ (iOS Share Sheet -> Â≠òÂÇ®ÂõæÂÉè)
                    tempCanvas.toBlob(blob => {
                        const file = new File([blob], `polaroid_${Date.now()}.jpg`, { type: "image/jpeg" });

                        if (navigator.canShare && navigator.canShare({ files: [file] })) {
                            navigator.share({
                                files: [file],
                                title: 'Â§çÂè§ÊãçÁ´ãÂæó',
                                text: 'ÂàöÂàöÊãçÁöÑÁÖßÁâáÔºÅ'
                            }).catch(err => {
                                // Áî®Êà∑ÂèñÊ∂àÊàñÂ§±Ë¥•ÔºåËøôÈáå‰∏çÂÅöÂ§ÑÁêÜÔºåÂõ†‰∏∫Áî®Êà∑ÂèØËÉΩÂè™ÊòØ‰∏çÂ∞èÂøÉÁÇπÈîô‰∫Ü
                                // Â¶ÇÊûúÊÉ≥Âº∫Âà∂ fallbackÔºåÂèØ‰ª•Âú®ËøôÈáåË∞ÉÁî® showSaveModal
                            });
                        } else {
                            // 2. Â¶ÇÊûú‰∏çÊîØÊåÅÂàÜ‰∫´ (ÊØîÂ¶ÇÊ°åÈù¢Á´ØÊàñÊóßiOS)Ôºå‰ΩøÁî®ÂºπÁ™óÈ¢ÑËßà
                            const finalUrl = tempCanvas.toDataURL('image/jpeg', 0.9);
                            showSaveModal(finalUrl);
                        }
                    }, 'image/jpeg', 0.9);
                };
                img.src = imgData;
            }

            function showSaveModal(url) {
                els.saveImgPreview.src = url;
                els.saveModal.classList.add('visible');
            }

            function createPhotoElement(imgData, isNew = false, savedProps = null) {
                const id = savedProps ? savedProps.id : Date.now();
                const rotation = savedProps ? savedProps.rotation : (Math.random() - 0.5) * 10;

                const wrapper = document.createElement('div');
                wrapper.className = 'polaroid-photo';
                wrapper.id = 'photo-' + id;

                const content = document.createElement('div');
                content.className = 'photo-content';
                if (!isNew) content.classList.add('developed');

                const img = document.createElement('img');
                img.src = imgData;

                const downloadBtn = document.createElement('div');
                downloadBtn.className = 'download-btn';
                downloadBtn.innerHTML = '‚¨á';

                const handleDownload = (e) => {
                    e.stopPropagation();
                    // Ê∑ªÂä†ÈúáÂä®ÂèçÈ¶à
                    if (navigator.vibrate) navigator.vibrate(50);
                    downloadPolaroid(imgData);
                };

                downloadBtn.addEventListener('mousedown', handleDownload);
                downloadBtn.addEventListener('touchstart', handleDownload, { passive: false });

                content.appendChild(img);
                wrapper.appendChild(content);
                wrapper.appendChild(downloadBtn);

                if (isNew) {
                    els.slot.appendChild(wrapper);
                    wrapper.getBoundingClientRect();

                    requestAnimationFrame(() => {
                        wrapper.classList.add('in-slot');
                        wrapper.style.transform = `translateY(-260px) rotate(${rotation}deg)`;
                        setTimeout(() => content.classList.add('developing'), 500);
                        setTimeout(() => {
                            moveToWall(wrapper, id, rotation, imgData);
                        }, 1000);
                    });
                } else {
                    els.wall.appendChild(wrapper);
                    wrapper.style.left = savedProps.x;
                    wrapper.style.top = savedProps.y;
                    wrapper.style.transform = `rotate(${savedProps.rotation}deg)`;
                    enableDrag(wrapper, id);
                }
            }

            function moveToWall(el, id, rotation, imgData) {
                const rect = el.getBoundingClientRect();
                els.wall.appendChild(el);
                el.classList.remove('in-slot');
                el.style.position = 'absolute';
                el.style.left = rect.left + 'px';
                el.style.top = rect.top + 'px';
                el.style.transform = `rotate(${rotation}deg)`;

                const photoData = {
                    id: id,
                    x: rect.left + 'px',
                    y: rect.top + 'px',
                    rotation: rotation,
                    imgData: imgData
                };
                state.photos.push(photoData);
                saveToStorage();

                enableDrag(el, id);
            }

            function enableDrag(el, id) {
                let isDragging = false;
                let startX, startY, startLeft, startTop;

                const onStart = (e) => {
                    if (e.target.classList.contains('download-btn')) return;

                    state.zIndex++;
                    el.style.zIndex = state.zIndex;
                    el.classList.add('dragging');
                    els.trash.classList.add('visible');

                    const t = e.touches ? e.touches[0] : e;
                    startX = t.clientX;
                    startY = t.clientY;
                    startLeft = parseFloat(el.style.left);
                    startTop = parseFloat(el.style.top);
                    isDragging = true;
                };

                const onMove = (e) => {
                    if (!isDragging) return;
                    if (e.cancelable) e.preventDefault();

                    const t = e.touches ? e.touches[0] : e;
                    const dx = t.clientX - startX;
                    const dy = t.clientY - startY;

                    el.style.left = (startLeft + dx) + 'px';
                    el.style.top = (startTop + dy) + 'px';

                    const trashRect = els.trash.getBoundingClientRect();
                    if (t.clientX > trashRect.left && t.clientY < trashRect.bottom) {
                        els.trash.style.transform = "scale(1.2)";
                    } else {
                        els.trash.style.transform = "scale(1)";
                    }
                };

                const onEnd = (e) => {
                    if (!isDragging) return;
                    isDragging = false;
                    el.classList.remove('dragging');
                    els.trash.classList.remove('visible');

                    const t = e.changedTouches ? e.changedTouches[0] : e;
                    const trashRect = els.trash.getBoundingClientRect();
                    if (t.clientX > trashRect.left && t.clientY < trashRect.bottom) {
                        el.remove();
                        state.photos = state.photos.filter(p => p.id !== id);
                        saveToStorage();
                        if (navigator.vibrate) navigator.vibrate(100);
                    } else {
                        const p = state.photos.find(p => p.id === id);
                        if (p) {
                            p.x = el.style.left;
                            p.y = el.style.top;
                            saveToStorage();
                        }
                    }
                };

                el.addEventListener('touchstart', onStart, { passive: false });
                el.addEventListener('touchmove', onMove, { passive: false });
                el.addEventListener('touchend', onEnd);

                el.addEventListener('mousedown', onStart);
                window.addEventListener('mousemove', onMove);
                window.addEventListener('mouseup', onEnd);
            }

            function saveToStorage() {
                try {
                    if (state.photos.length > 15) {
                        state.photos = state.photos.slice(state.photos.length - 15);
                    }
                    localStorage.setItem('polaroid_photos_v2', JSON.stringify(state.photos));
                } catch (e) {
                    console.log("Storage full or error");
                }
            }

            function loadSavedPhotos() {
                const data = localStorage.getItem('polaroid_photos_v2');
                if (data) {
                    try {
                        const parsed = JSON.parse(data);
                        state.photos = parsed;
                        parsed.forEach(p => {
                            createPhotoElement(p.imgData, false, p);
                        });
                    } catch (e) {
                        console.error("Load error", e);
                    }
                }
            }
        });
    </script>
</body>

</html>